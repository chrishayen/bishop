// ============================================
// Async Functions
// ============================================

async fn async_returns_int() -> int {
    return 42;
}

async fn async_add(int a, int b) -> int {
    return a + b;
}

async fn async_with_await() -> int {
    result := await async_returns_int();
    return result;
}

async fn async_void_fn() {
    x := 1;
}

async fn async_typed_await() -> int {
    int val = await async_returns_int();
    return val;
}

async fn async_multiple_awaits() -> int {
    a := await async_returns_int();
    b := await async_add(a, 10);
    return b;
}

async fn async_await_in_expr() -> int {
    result := await async_returns_int() + 10;
    return result;
}

async fn async_nested() -> int {
    result := await async_add(await async_returns_int(), 5);
    return result;
}

// ============================================
// Async Methods
// ============================================

Counter :: struct {
    value int
}

async Counter :: get_value_async(self) -> int {
    return self.value;
}

async Counter :: add_async(self, int amount) -> int {
    current := await self.get_value_async();
    return current + amount;
}

async Counter :: increment_async(self) {
    self.value = self.value + 1;
}

// ============================================
// Channel Creation
// ============================================

async fn test_channel_create() {
    ch := Channel<int>();
}

async fn test_channel_types() {
    ch_int := Channel<int>();
    ch_str := Channel<str>();
    ch_bool := Channel<bool>();
}

// ============================================
// Channel Send/Recv
// ============================================

async fn test_send_recv() {
    ch := Channel<int>();
    await ch.send(42);
    val := await ch.recv();
}

// ============================================
// Select Statement
// ============================================

async fn test_select_recv() {
    ch1 := Channel<int>();
    ch2 := Channel<int>();

    select {
        case val := ch1.recv() {
            x := val + 1;
        }
        case val := ch2.recv() {
            x := val + 2;
        }
    }
}

// ============================================
// Sync test
// ============================================

fn test_sync_still_works() {
    x := 1;
    assert_eq(x, 1);
}
